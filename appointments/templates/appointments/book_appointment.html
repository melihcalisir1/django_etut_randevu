{% extends 'appointments/base_student.html' %}

{% block title %}Randevu Al{% endblock %}

{% block student_content %}
<h2 class="mb-3">üéì Randevu Al</h2>

<div class="card p-4">
    <h5>{{ availability.date }} - {{ availability.start_time }} / {{ availability.end_time }}</h5>
    <form method="POST" class="mt-3" id="appointmentForm">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">Bran≈ü Se√ß:</label>
            <div class="form-check">
                {% for branch in branches %}
                <input type="checkbox" class="form-check-input" name="branches" value="{{ branch.id }}" id="branch{{ branch.id }}">
                <label for="branch{{ branch.id }}" class="form-check-label">{{ branch.name }}</label><br>
                {% endfor %}
            </div>
        </div>
        <button type="submit" class="btn btn-success w-100" id="submitBtn">
            <span id="btnText">üìÖ Randevu Al</span>
            <span id="btnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
        </button>
    </form>
    <a href="{% url 'availability_list' %}" class="btn btn-outline-secondary w-100 mt-2">‚Üê Geri d√∂n</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Hata mesajƒ± varsa g√∂ster
    {% if error_message %}
    Swal.fire({
        title: '‚ùå Hata!',
        text: '{{ error_message }}',
        icon: 'error',
        confirmButtonText: 'Tamam',
        confirmButtonColor: '#d33'
    });
    {% endif %}

    // Ba≈üarƒ± mesajƒ± varsa g√∂ster
    {% if success_message %}
    Swal.fire({
        title: '‚úÖ Ba≈üarƒ±lƒ±!',
        text: '{{ success_message }}',
        icon: 'success',
        confirmButtonText: 'Tamam',
        confirmButtonColor: '#28a745'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = "{% url 'availability_list' %}";
        }
    });
    {% endif %}

    // Form g√∂nderimi
    document.getElementById('appointmentForm').addEventListener('submit', function(e) {
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');
        
        // Bran≈ü se√ßimi kontrol√º
        const selectedBranches = document.querySelectorAll('input[name="branches"]:checked');
        if (selectedBranches.length === 0) {
            e.preventDefault();
            Swal.fire({
                title: '‚ö†Ô∏è Uyarƒ±!',
                text: 'L√ºtfen en az bir bran≈ü se√ßin!',
                icon: 'warning',
                confirmButtonText: 'Tamam',
                confirmButtonColor: '#ffc107'
            });
            return;
        }

        // Loading durumu
        submitBtn.disabled = true;
        btnText.textContent = 'ƒ∞≈üleniyor...';
        btnSpinner.classList.remove('d-none');
    });
});
</script>
{% endblock %}